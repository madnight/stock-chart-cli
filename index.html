<!DOCTYPE html>
<html>
<head>
    <title>Stock Data</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
            border: 1px solid #ddd;
        }
        th {
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        tr:hover {
            background-color: #ddd;
        }
    </style>
</head>
<body>
    <div id="tableDiv"></div>
    <script>
    async function generateTable() {


        var div = document.getElementById("tableDiv");
    
        // Fetch data from the API

        var queryString = window.location.search.substring(1);
        var symbols = queryString.split(',');
        // Function to fetch data for a single symbol
        async function fetchDataForSymbol(symbol) {
            try {
                var response = await fetch(`https://corsproxy.io/?https%3A%2F%2Ffinance.beuke.org%2F/quote/${symbol}`);
                var data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data for symbol:', symbol, error);
            }
        }
        // Function to loop through all symbols and fetch their data
        async function fetchAllSymbolsData(symbols) {
            var allData = [];
            for (let symbol of symbols) {
                var data = await fetchDataForSymbol(symbol);
                if (data) {
                    allData.push(data);
                }
            }

        stocks = [];
        allData.forEach(stockData => {
            stocks.push({
                'Symbol': stockData['symbol'],
                'Price': '$' + stockData['Price'],
                'Change': stockData['Change'],
                'Average Volume': stockData['Avg Volume'],
                'P/E': stockData['P/E'],
                'Market Cap': stockData['Market Cap'],
                '52W Low': '$' + stockData['52W Low'],
                '52W High': '$' + stockData['52W High'],
                'YTD Change': stockData['Perf YTD']
            });
        });
        var table = document.createElement("table");
    
        // Create the header row
        var thead = document.createElement("thead");
        var headerRow = document.createElement("tr");
        for (var header in stocks[0]) {
            var th = document.createElement("th");
            var thText = document.createTextNode(header);
            th.appendChild(thText);
            headerRow.appendChild(th);
        }
        thead.appendChild(headerRow);
        table.appendChild(thead);
    
        // Create the body
        var tbody = document.createElement("tbody");
        for (var i = 0; i < stocks.length; i++) {
            var row = document.createElement("tr");
            for (var property in stocks[i]) {
                var cell = document.createElement("td");
                var cellText = document.createTextNode(stocks[i][property]);
                cell.appendChild(cellText);
                row.appendChild(cell);
            }
            tbody.appendChild(row);
        }
    
        table.appendChild(tbody);
        div.appendChild(table);
    }

// Call the function to fetch data for all symbols
fetchAllSymbolsData(symbols).then(allData => {
    console.log('All data fetched:', allData);
}).catch(error => {
    console.error('Error fetching data for all symbols:', error);
});




}

    
    generateTable();
    </script>
</body>
</html>
